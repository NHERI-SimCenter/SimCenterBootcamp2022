

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>C: Assignments Day 5 &mdash; Programming Bootcamp 2022  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/hacks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Git" href="git.html" />
    <link rel="prev" title="C: Assignments Day 4" href="assignment_C4.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Programming Bootcamp 2022
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="setupInstructions.html">Setup Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture_videos.html">Self-Study Videos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="assignments.html">Assignments</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="assignment_day1.html">Python: Assignments Day 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_day2.html">Python: Assignments Day 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_day3.html">Python: Assignments Day 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_day4.html">Python: Assignments Day 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_day5.html">Python: Assignments Day 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_C1.html">C: Assignments Day 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_C2.html">C: Assignments Day 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_C3.html">C: Assignments Day 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="assignment_C4.html">C: Assignments Day 4</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">C: Assignments Day 5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-setting-up-an-execution-system">Step 1: Setting Up an Execution System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-exploring-file-system-commands">Step 2: Exploring File System Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-build-a-tapis-app">Step 3: Build a Tapis app</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-submitting-a-job">Step 4: Submitting a Job</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-allowing-others-to-use-your-app">Step 5: Allowing Others to Use your App</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="git.html">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="emacs.html">Emacs</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmake.html">Cmake</a></li>
<li class="toctree-l1"><a class="reference internal" href="TACC.html">TACC-Frontera</a></li>
<li class="toctree-l1"><a class="reference internal" href="tapis.html">Tapis CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Questions, Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional Resources</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Programming Bootcamp 2022</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="assignments.html">Assignments</a> &raquo;</li>
        
      <li>C: Assignments Day 5</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/source/assignment_C5.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="c-assignments-day-5">
<h1>C: Assignments Day 5<a class="headerlink" href="#c-assignments-day-5" title="Permalink to this headline">¶</a></h1>
<p>The purpose of these exercises is to set it up so that you are able to run a parallel application on Frontera or Stampede2 by issuing commands in the terminal of your desktop using your DesignSafe account and resources. Time permitting we will share the applications with fellow classmates. The advantage of being able to do this from a terminal is convenience and speed, e.g. you no longer will be required to login and find a token, cd to appropriate directories, edit submit scripts, and so on. Ultimately, as you progress in your careers you will begin to understand, the ability to share your work is one of the really great advantages provided.</p>
<p>There are <strong>5</strong> steps to the exercise today. The steps follow the videos presented for today’s class (these are enclosed in hints herein). The exercises are outlined below the <strong>hint</strong>.</p>
<p>However, before you can begin, you need to make sure the <strong>tapis</strong> command is working from a terminal application on your desktop. The <strong>note</strong> contains setup instructions for this. The <strong>warning</strong> is a warning about possible changes that you may need to make if you are running <strong>Windows 10</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>Before you can proceed, initial setup is required of the <strong>Tapis-cli</strong>. This is done by invoking the following command in a linux (see warning below) shell. For some systems, i.e. <strong>ubuntu</strong> you should use <strong>pip3</strong> instead of <strong>pip</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tapis</span><span class="o">-</span><span class="n">cli</span>
</pre></div>
</div>
</div></blockquote>
<p>Once the cli is installed you need to configure it to use deignsafe. For this purpose you need to provide your username and password:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">auth</span> <span class="n">init</span>
</pre></div>
</div>
<p>The application will prompt for a number of things. For tenant enter <strong>designsafe</strong>, for username and password your DesignSafe username and password. For other things, ignore by just hitting enter.</p>
</div></blockquote>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you fail the last part of this first exercise it means that the <strong>tapis-cli</strong> is not going to work. From past experience we have found that the install works for some, but not all, and we are not sure why. You can still use the work you have done up until that point in the exercise, but you need to do something different different to complete it. We provide 3 solutions, in order of time to proceed:</p>
<ol class="arabic simple">
<li><p>Try to update to the latest version of <strong>tapis-cli</strong>:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/TACC-Cloud/tapis-cli.git
$ cd tapis-cli
$ pip install --upgrade .
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Run the exercise at TACC using either Frontera or Stampede2. To do this you need to login to your TACC machine and install <strong>tapis-cli</strong> as a local user.</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">intall</span> <span class="n">tapis</span><span class="o">-</span><span class="n">cli</span> <span class="o">--</span><span class="n">user</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Install and use the <strong>Ubuntu subsystem on Windows 10</strong></p></li>
</ol>
<p>The Ubuntu subsystem is actually a full Ubuntu linux system running within a virtual machine while
Windows is running as the primary OS. Microsoft provides step-by-step instructions on how to install
it on your Windows system.  See
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a>
for details.</p>
<p><span class="red">Warning</span>: If you are running Windows in a virtual environment such as VMware or Parallels,
installing the Ubuntu subsystem in Windows will fail.  Install Ubuntu in a separate virtual machine
instead.</p>
</div>
<div class="section" id="step-1-setting-up-an-execution-system">
<h2>Step 1: Setting Up an Execution System<a class="headerlink" href="#step-1-setting-up-an-execution-system" title="Permalink to this headline">¶</a></h2>
<p>Tapis provides <strong>systems</strong> which provide access to the file systems and hardware resources, e.g. Frontera and Stampede, at TACC. For our <strong>Storage System</strong> we will be using the default provided by DesignSafe (designsafe.storage.default). In this exercise we are going to create an execution system by creating/modifying a .json file containing basic information about one of our machine logins (e.g. username, password), and locations within our machine account of directories to place temporary files (the location where files are placed when we run an app).</p>
<p>Before you create a system, you might want to issue some tapis commands to get comfortable with the tapis-cli.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="o">-</span><span class="n">h</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="o">-</span><span class="n">h</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">search</span> <span class="o">--</span><span class="n">default</span> <span class="n">eq</span> <span class="n">true</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">show</span> <span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="nb">list</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">search</span> <span class="o">--</span><span class="n">execution</span><span class="o">-</span><span class="nb">type</span> <span class="n">eq</span> <span class="n">HPC</span>
</pre></div>
</div>
</div></blockquote>
<p>You first need to edit one of the files provided in the <strong>code/agave/</strong> agave directory. In this folder we have provided two template systems to chooose from , <strong>fronteraSystem.json</strong> and <strong>stampede2Syatem.json</strong>. Which one to use depends on which TACC system you have been logging into.</p>
<p>The Frontera file is shown below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="p">{</span>
<span class="linenos">  2</span>    <span class="nt">&quot;maxSystemJobs&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
<span class="linenos">  3</span>    <span class="nt">&quot;executionType&quot;</span><span class="p">:</span> <span class="s2">&quot;HPC&quot;</span><span class="p">,</span>
<span class="linenos">  4</span>    <span class="nt">&quot;available&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="linenos">  5</span>    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Frontera has two computing subsystems, a primary computing system focused on double precision performance, and a second subsystem focused on single precision streaming-memory computing.&quot;</span><span class="p">,</span>
<span class="linenos">  6</span>    <span class="nt">&quot;storage&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">  7</span>        <span class="nt">&quot;proxy&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos">  8</span>        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;SFTP&quot;</span><span class="p">,</span>
<span class="linenos">  9</span>        <span class="nt">&quot;mirror&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 10</span>        <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;frontera.tacc.utexas.edu&quot;</span><span class="p">,</span>
<span class="linenos"> 11</span>        <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
<span class="linenos"> 12</span>        <span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 13</span>            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;PASSWORD&quot;</span><span class="p">,</span>
<span class="linenos"> 14</span>            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;${USERNAME}&quot;</span><span class="p">,</span>
<span class="linenos"> 15</span>            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;${PASSWORD}&quot;</span>
<span class="linenos"> 16</span>        <span class="p">},</span>
<span class="linenos"> 17</span>        <span class="nt">&quot;homeDir&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<span class="linenos"> 18</span>        <span class="nt">&quot;rootDir&quot;</span><span class="p">:</span> <span class="s2">&quot;${SCRATCH_DIR}&quot;</span>
<span class="linenos"> 19</span>    <span class="p">},</span>
<span class="linenos"> 20</span>    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EXECUTION&quot;</span><span class="p">,</span>
<span class="linenos"> 21</span>    <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 22</span>        <span class="nt">&quot;proxy&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 23</span>        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;SSH&quot;</span><span class="p">,</span>
<span class="linenos"> 24</span>        <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
<span class="linenos"> 25</span>        <span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 26</span>            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;PASSWORD&quot;</span><span class="p">,</span>
<span class="linenos"> 27</span>            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;${USERNAME}&quot;</span><span class="p">,</span>
<span class="linenos"> 28</span>            <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;${PASSWORD}&quot;</span>
<span class="linenos"> 29</span>        <span class="p">},</span>
<span class="linenos"> 30</span>        <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;frontera.tacc.utexas.edu&quot;</span>
<span class="linenos"> 31</span>    <span class="p">},</span>
<span class="linenos"> 32</span>    <span class="nt">&quot;startupScript&quot;</span><span class="p">:</span> <span class="s2">&quot;~/.bashrc&quot;</span><span class="p">,</span>
<span class="linenos"> 33</span>    <span class="nt">&quot;scheduler&quot;</span><span class="p">:</span> <span class="s2">&quot;SLURM&quot;</span><span class="p">,</span>
<span class="linenos"> 34</span>    <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 35</span>    <span class="nt">&quot;public&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 36</span>    <span class="nt">&quot;maxSystemJobsPerUser&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
<span class="linenos"> 37</span>    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;demo.exec.frontera.${USERNAME}&quot;</span><span class="p">,</span>
<span class="linenos"> 38</span>    <span class="nt">&quot;workDir&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 39</span>    <span class="nt">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;tacc.utexas.edu&quot;</span><span class="p">,</span>
<span class="linenos"> 40</span>    <span class="nt">&quot;environment&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 41</span>    <span class="nt">&quot;queues&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos"> 42</span>        <span class="p">{</span>
<span class="linenos"> 43</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span>
<span class="linenos"> 44</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos"> 45</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;192GB&quot;</span><span class="p">,</span>
<span class="linenos"> 46</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="linenos"> 47</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;48:00:00&quot;</span><span class="p">,</span>
<span class="linenos"> 48</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 49</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
<span class="linenos"> 50</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">28672</span><span class="p">,</span>
<span class="linenos"> 51</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 52</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="linenos"> 53</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos"> 54</span>        <span class="p">},</span>
<span class="linenos"> 55</span>        <span class="p">{</span>
<span class="linenos"> 56</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos"> 58</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;192GB&quot;</span><span class="p">,</span>
<span class="linenos"> 59</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 60</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;02:00:00&quot;</span><span class="p">,</span>
<span class="linenos"> 61</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 62</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
<span class="linenos"> 63</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">2240</span><span class="p">,</span>
<span class="linenos"> 64</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 65</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 66</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos"> 67</span>        <span class="p">},</span>
<span class="linenos"> 68</span>        <span class="p">{</span>
<span class="linenos"> 69</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;large&quot;</span><span class="p">,</span>
<span class="linenos"> 70</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos"> 71</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;192GB&quot;</span><span class="p">,</span>
<span class="linenos"> 72</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 73</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;48:00:00&quot;</span><span class="p">,</span>
<span class="linenos"> 74</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 75</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span>
<span class="linenos"> 76</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">114688</span><span class="p">,</span>
<span class="linenos"> 77</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 78</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="linenos"> 79</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos"> 80</span>        <span class="p">},</span>
<span class="linenos"> 81</span>        <span class="p">{</span>
<span class="linenos"> 82</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;flex&quot;</span><span class="p">,</span>
<span class="linenos"> 83</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos"> 84</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;192GB&quot;</span><span class="p">,</span>
<span class="linenos"> 85</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 86</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;48:00:00&quot;</span><span class="p">,</span>
<span class="linenos"> 87</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 88</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
<span class="linenos"> 89</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">7168</span><span class="p">,</span>
<span class="linenos"> 90</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos"> 91</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="linenos"> 92</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos"> 93</span>        <span class="p">},</span>
<span class="linenos"> 94</span>        <span class="p">{</span>
<span class="linenos"> 95</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rtx&quot;</span><span class="p">,</span>
<span class="linenos"> 96</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos"> 97</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;128GB&quot;</span><span class="p">,</span>
<span class="linenos"> 98</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos"> 99</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;48:00:00&quot;</span><span class="p">,</span>
<span class="linenos">100</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos">101</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
<span class="linenos">102</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos">103</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos">104</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="linenos">105</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos">106</span>        <span class="p">},</span>
<span class="linenos">107</span>        <span class="p">{</span>
<span class="linenos">108</span>            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rtx-dev&quot;</span><span class="p">,</span>
<span class="linenos">109</span>            <span class="nt">&quot;maxJobs&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos">110</span>            <span class="nt">&quot;maxMemoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;128GB&quot;</span><span class="p">,</span>
<span class="linenos">111</span>            <span class="nt">&quot;default&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos">112</span>            <span class="nt">&quot;maxRequestedTime&quot;</span><span class="p">:</span> <span class="s2">&quot;02:00:00&quot;</span><span class="p">,</span>
<span class="linenos">113</span>            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos">114</span>            <span class="nt">&quot;maxNodes&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="linenos">115</span>            <span class="nt">&quot;maxProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">-1</span><span class="p">,</span>
<span class="linenos">116</span>            <span class="nt">&quot;mappedName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="linenos">117</span>            <span class="nt">&quot;maxUserJobs&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="linenos">118</span>            <span class="nt">&quot;customDirectives&quot;</span><span class="p">:</span> <span class="s2">&quot;${ALLOCATION}&quot;</span>
<span class="linenos">119</span>        <span class="p">}</span>
<span class="linenos">120</span>    <span class="p">],</span>
<span class="linenos">121</span>    <span class="nt">&quot;globalDefault&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="linenos">122</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;${USERNAME} Frontera HPC DEMO Execution System for DesignSafe&quot;</span><span class="p">,</span>
<span class="linenos">123</span>    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;UP&quot;</span><span class="p">,</span>
<span class="linenos">124</span>    <span class="nt">&quot;scratchDir&quot;</span><span class="p">:</span> <span class="s2">&quot;${SCRATCH_DIR}&quot;</span>
<span class="linenos">125</span><span class="p">}</span>
</pre></div>
</div>
<p>In this file you need to search for a few words and replace them with appropriate text.
These are the four values that need to be replaced:</p>
<p>${USERNAME},
${PASSWORD},
${SCRATCH_DIR} and
${ALLOCATION}.</p>
<p>The <strong>${ALLOCATION}</strong> text is replaced with <strong>-A FTA-DD-SimCenter</strong> if using Frontera.
The scratch_dir can be found by logging into Frontera, issuing the commands cds (change dir to scratch) and then pwd (print working directory). The results of pwd is your scratch dir.</p>
<p>Once the file has been completed, you can create the system by invoking one of the the following commands:</p>
<p>for Frontera:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">systems</span> <span class="n">create</span>  <span class="o">-</span><span class="n">F</span> <span class="n">fronteraSystem</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Once created, search for it. In the file we named it demo something (see line 27 above).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">systems</span> <span class="n">search</span> <span class="o">--</span><span class="n">name</span> <span class="n">like</span> <span class="n">demo</span> <span class="o">-</span><span class="n">f</span> <span class="n">json</span>
</pre></div>
</div>
<p>The system should appear in what is returned.</p>
</div></blockquote>
<p>That’s it, congratulations!! You have created an execution system.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never ever ever check the file into github unless you remove your <strong>password</strong>. We suggest editing this file elasewhere and then removing it when the task is completed.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>A demonstration is contained at the end of the Video</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/TddwsA5MY_I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p></div>
</div>
<div class="section" id="step-2-exploring-file-system-commands">
<h2>Step 2: Exploring File System Commands<a class="headerlink" href="#step-2-exploring-file-system-commands" title="Permalink to this headline">¶</a></h2>
<p>Tapis provides commands for doing file operartions. It provides commands for uploading and downloading files to and from the storage systems as well as typical commands dealing with file system opeartions at thr remove stoarge system.</p>
<p>Some commands we would like you to try.</p>
<p>Begin by listing the files in your home directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="nb">list</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">YOUR_NAME</span>
</pre></div>
</div>
<p>Add a directory tmp to your home folder at DesignSafe</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="n">mkdir</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">YOUR_NAME</span> <span class="n">tmp</span>
</pre></div>
</div>
<p>Copy the small file <strong>SimCenterBootcamp2022/code/agave/ExerciseDays4/ex1/piMPI.c</strong> to your current directory. From there send it to your new folder at DesignSafe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="n">upload</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">YOUR_NAME</span><span class="o">/</span><span class="n">tmp</span>  <span class="n">piMPI</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will be using this file in our app. We will compile it and run it. If yours worked from yesterday, upload your file instead. It makes the exercise somewhat more meaningful. If your file has a different name, you should be able to identify what small change you have to make in the <strong>submitClone.json</strong> file you will edit later.</p>
</div>
<p>Remove your local copy and try and copy the file you just uploaded.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="n">download</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">YOUR_NAME</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">piMPI</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p>List the other <strong>tapis</strong> file commands and explore what they do.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>A demonstartion is contained at end of the Video</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/eh7Etvuvo7E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p></div>
</div>
<div class="section" id="step-3-build-a-tapis-app">
<h2>Step 3: Build a Tapis app<a class="headerlink" href="#step-3-build-a-tapis-app" title="Permalink to this headline">¶</a></h2>
<p>A Tapis <strong>apps</strong> is a containerized application. Each app has a description that describes it’s name, inputs and parameters. This description can be obtained using the <strong>tapis apps show</strong> command. The description contains information about where the container for the application resides, inputs and outputs, information about the execution system on which the app will run and information about a bash script, typically called <strong>wrapper.sh</strong>. The bash script is the srcipt that is run when the application is started running at a HPC resource. The bash script will have access to all the files in the app container when it is run as well as all files and directories provided through the <strong>inputs</strong>.</p>
<p>We are going a develop a tapis container application and we are going to use some tapis apps and files comamnds to do so. To build our app, like all programmers do, we are going to start by cloning an existing one that has similar inputs to the one we want, basically an input directory and a parameter. We will name the app <strong>mpiCompileRun</strong> and associate it with the exe service we created in exercise 1. (You will need the name). Use the following command to see what is needed.</p>
<p>The app we have in mind is one that will compile a program we have uploaded <strong>piMPI.c</strong> and run it. The wrapper will utilize two variables <strong>programFile</strong>, the name of the file to compile and run, and <strong>inputDirectory</strong> the location of the directory containg the file. A wrapper.sh file for this purpose is shown below. Line 1 through 4 and 13 through 17 are required for Tapis. The other lines are linux commands you have been using, module load to load the intel compiler, we next change the directory to the inputDirectory, and finally compile the program and then run it  with <strong>ibrun</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>set -x
<span class="linenos"> 2</span>WRAPPERDIR=$( cd &quot;$( dirname &quot;$0&quot; )&quot; &amp;&amp; pwd )
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>${AGAVE_JOB_CALLBACK_RUNNING}
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>module load intel
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>cd &quot;${inputDirectory}&quot;
<span class="linenos"> 9</span>
<span class="linenos">10</span>mpicc ${programFile}
<span class="linenos">11</span>ibrun ./a.out
<span class="linenos">12</span>
<span class="linenos">13</span>if [ ! $? ]; then
<span class="linenos">14</span>        echo &quot;program exited with an error status. $?&quot; &gt;&amp;2
<span class="linenos">15</span>        ${AGAVE_JOB_CALLBACK_FAILURE}
<span class="linenos">16</span>        exit
<span class="linenos">17</span>fi
</pre></div>
</div>
<p>We are first going to search for an app to clone. Let us look at simcenter apps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">search</span> <span class="o">--</span><span class="n">name</span> <span class="n">like</span> <span class="n">simcenter</span> <span class="o">-</span><span class="n">f</span> <span class="n">json</span>
</pre></div>
</div>
<p>You should see one with an id <strong>simcenter-dakota-1.0.0u1</strong>. Have a look at it’s description.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">show</span> <span class="n">simcenter</span><span class="o">-</span><span class="n">dakota</span><span class="o">-</span><span class="mf">1.0.0</span><span class="n">u1</span> <span class="o">-</span><span class="n">f</span> <span class="n">json</span>
</pre></div>
</div>
<p>Amidst the results returned, you will see it takes an input directory and some parameters to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;simcenter-dakota-1.0.0u1&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span>  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;simcenter-dakota&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span>  <span class="s2">&quot;executionSystem&quot;</span><span class="p">:</span> <span class="s2">&quot;designsafe.simcenter.exec.stampede2&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span>  <span class="s2">&quot;deploymentSystem&quot;</span><span class="p">:</span> <span class="s2">&quot;designsafe.storage.default&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span>  <span class="s2">&quot;available&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
<span class="linenos"> 7</span>  <span class="s2">&quot;parallelism&quot;</span><span class="p">:</span> <span class="s2">&quot;PARALLEL&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>  <span class="s2">&quot;defaultProcessorsPerNode&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
<span class="linenos"> 9</span>  <span class="s2">&quot;defaultMemoryPerNode&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">10</span>  <span class="s2">&quot;defaultNodeCount&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
<span class="linenos">11</span>  <span class="s2">&quot;defaultMaxRunTime&quot;</span><span class="p">:</span> <span class="s2">&quot;06:00:00&quot;</span><span class="p">,</span>
<span class="linenos">12</span>  <span class="o">......</span>
<span class="linenos">13</span>  <span class="o">......</span>
<span class="linenos">14</span>  <span class="s2">&quot;modules&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos">15</span>    <span class="s2">&quot;load dakota&quot;</span>
<span class="linenos">16</span>  <span class="p">],</span>
<span class="linenos">17</span>  <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos">18</span>    <span class="p">{</span>
<span class="linenos">19</span>	<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;inputDirectory&quot;</span><span class="p">,</span>
<span class="linenos">20</span>	<span class="o">.....</span>
<span class="linenos">21</span>      <span class="p">},</span>
<span class="linenos">22</span>      <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">23</span>	<span class="o">.....</span>
<span class="linenos">24</span>      <span class="p">},</span>
<span class="linenos">25</span>      <span class="s2">&quot;semantics&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">26</span>	<span class="o">.....</span>
<span class="linenos">27</span>      <span class="p">}</span>
<span class="linenos">28</span>    <span class="p">}</span>
<span class="linenos">29</span>  <span class="p">],</span>
<span class="linenos">30</span>  <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos">31</span>    <span class="p">{</span>
<span class="linenos">32</span>      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;driverFile&quot;</span><span class="p">,</span>
<span class="linenos">33</span>      <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">34</span>	<span class="o">.....</span>	    
<span class="linenos">35</span>      <span class="p">},</span>
<span class="linenos">36</span>      <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">37</span>	<span class="o">.....</span>
<span class="linenos">38</span>      <span class="p">},</span>
<span class="linenos">39</span>      <span class="s2">&quot;semantics&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">40</span>      <span class="p">}</span>
<span class="linenos">41</span>    <span class="p">},</span>
<span class="linenos">42</span>    <span class="p">{</span>
<span class="linenos">43</span>      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;modules&quot;</span><span class="p">,</span>
<span class="linenos">44</span>      <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">45</span>	<span class="o">.....</span>	    
<span class="linenos">46</span>      <span class="p">},</span>
<span class="linenos">47</span>      <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">48</span>	<span class="o">.....</span>
<span class="linenos">49</span>      <span class="p">},</span>
<span class="linenos">50</span>      <span class="s2">&quot;semantics&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">51</span>	<span class="o">.....</span>
<span class="linenos">52</span>      <span class="p">}</span>
<span class="linenos">53</span>    <span class="p">},</span>
<span class="linenos">54</span>    <span class="o">....</span>
<span class="linenos">55</span>  <span class="p">],</span>
<span class="linenos">56</span>  <span class="o">......</span>
<span class="linenos">57</span>  <span class="o">......</span>
<span class="linenos">58</span><span class="p">}</span>
</pre></div>
</div>
<p>We are going to use this app as our starting point. We are going to <strong>clone</strong> the app. Have a look at the inputs for <strong>tapis apps clone</strong> using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">clone</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>After having reviewed the results retrurned by the previous command, you should be able to understand the following. The command to clone is some <strong>modifications based on your account</strong>, i.e. the -e refers to the execution service and for that you need to enter the <strong>id</strong> of the execution service you created in step 1 (the id was on line 37). Also replace YOUR_NAME with yor login name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">clone</span> <span class="o">-</span><span class="n">e</span> <span class="n">demo</span><span class="o">.</span><span class="n">exec</span><span class="o">.</span><span class="n">frontera</span><span class="o">.</span><span class="n">YOUR_NAME</span> <span class="o">-</span><span class="n">n</span> <span class="n">mpiCompileRun</span><span class="o">.</span><span class="n">YOUR_NAME</span> <span class="o">-</span><span class="n">x</span> <span class="mf">0.0.1</span>  <span class="n">simcenter</span><span class="o">-</span><span class="n">dakota</span><span class="o">-</span><span class="mf">1.0.0</span><span class="n">u1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your name is not needed, it will be used in part 5 so that we can share applications and as such we will want to be able to distinguish between applications. For normal application development, you may not need or want it.</p>
</div>
<p>Having cloned the app, let us look at it’s description to see the inputs and outputs. We can get this description using the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">show</span> <span class="o">-</span><span class="n">f</span> <span class="n">json</span> <span class="n">mpiCompileRun</span><span class="o">.</span><span class="n">YOUR_NAME</span><span class="o">-</span><span class="mf">0.0.1</span> <span class="o">&gt;</span> <span class="n">mpiCompileRunYOUR_NAME</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This command has placed the description of the <strong>mpiCompileRun</strong> to the json file mpiCompileRun.json. Open it up and have a look. It will be similar to what was shown above, differences will be in the <strong>id</strong> and <strong>executionSystem</strong>. You will see the input and parameters section for this app. Also you will see the application directory, which is in your home/applications folder at designsafe. From the application directory download the wrapper.sh script. We will modify it a bit. We will keep the <strong>inputDirectory</strong> but will only have one input parameter <strong>programName</strong>. You need to edit the file before continuing, the edits should be obvious.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a difference between <strong>inputs</strong> and <strong>parameters</strong> arguments. <strong>inputs</strong> arguments are file or directory resources that will be copied by tapis to the directory where the wrapper script is run. <strong>paramaters</strong> are arguments used in the script. In our example we could have just spcified <strong>programFile</strong> as being an input, but we wanted to show use of <strong>inputs</strong> and <strong>parameters</strong> (and also this would allow you to compile programs with many files in an input directory).</p>
</div>
<p>After editing the app description file, we can update the app.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">update</span> <span class="o">-</span><span class="n">F</span> <span class="n">mpiCompileRunYOUR_NAME</span><span class="o">.</span><span class="n">json</span> <span class="n">mpiCompileRun</span><span class="o">.</span><span class="n">YOUR_NAME</span><span class="o">-</span><span class="mf">0.0.1</span>
</pre></div>
</div>
<p>Finally we need to replace the <strong>wrapper.sh</strong> of the existing app with our one. We do this with one of the tapis files system commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="n">upload</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">YOUR_NAME</span><span class="o">/</span><span class="n">applications</span><span class="o">/</span><span class="n">mpiCompileRun</span><span class="o">.</span><span class="n">YOUR_NAME</span><span class="o">-</span><span class="mf">0.0.1</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>We now have an application ready and waiting to compile our code and run it!</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>A demonstration is contained at the end of the Video</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/f2-Qg6sMsQM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p></div>
</div>
<div class="section" id="step-4-submitting-a-job">
<h2>Step 4: Submitting a Job<a class="headerlink" href="#step-4-submitting-a-job" title="Permalink to this headline">¶</a></h2>
<p>Now we want to actually submit a job and have it compile and run on a HPC. In the <strong>code/agave</strong> folder there is a file <strong>piMPI.c</strong> and a json file <strong>cloneSubmit.json</strong>. The <strong>piMPI.c</strong> we have alredy used in files and placed in a demo folder at designsafe off our remote home folder. To submit a job to run at TACC through tapis we need to create the input file telling tapis what to do. The input file is application specific. An input file template for our app is found in <strong>cloneSubmit.json</strong> which is shown below:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Run 1&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="nt">&quot;appId&quot;</span><span class="p">:</span> <span class="s2">&quot;mpiCompileSimCenter-0.0.1&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="nt">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 5</span>      <span class="nt">&quot;inputDirectory&quot;</span><span class="p">:</span> <span class="s2">&quot;agave://designsafe.storage.default/tg457427/demo2&quot;</span>
<span class="linenos"> 6</span>    <span class="p">},</span>
<span class="linenos"> 7</span>    <span class="nt">&quot;parameters&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 8</span>      <span class="nt">&quot;programFile&quot;</span><span class="p">:</span><span class="s2">&quot;piMPI.c&quot;</span>
<span class="linenos"> 9</span>    <span class="p">},</span>
<span class="linenos">10</span>    <span class="nt">&quot;maxRunTime&quot;</span><span class="p">:</span> <span class="s2">&quot;00:01:00&quot;</span><span class="p">,</span>
<span class="linenos">11</span>    <span class="nt">&quot;memoryPerNode&quot;</span><span class="p">:</span> <span class="s2">&quot;1GB&quot;</span><span class="p">,</span>
<span class="linenos">12</span>    <span class="nt">&quot;nodeCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="nt">&quot;processorsPerNode&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
<span class="linenos">14</span>    <span class="nt">&quot;maxRunTime&quot;</span><span class="p">:</span> <span class="s2">&quot;00:01:00&quot;</span><span class="p">,</span>
<span class="linenos">15</span>    <span class="nt">&quot;archive&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="linenos">16</span>    <span class="nt">&quot;archiveOnAppError&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="linenos">17</span>    <span class="nt">&quot;archiveSystem&quot;</span><span class="p">:</span><span class="s2">&quot;designsafe.storage.default&quot;</span><span class="p">,</span>
<span class="linenos">18</span>    <span class="nt">&quot;notifications&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos">19</span>      <span class="p">{</span>
<span class="linenos">20</span>        <span class="nt">&quot;url&quot;</span> <span class="p">:</span> <span class="s2">&quot;fmckenna@berkeley.edu&quot;</span><span class="p">,</span>
<span class="linenos">21</span>        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
<span class="linenos">22</span>      <span class="p">}</span>
<span class="linenos">23</span>    <span class="p">]</span>
<span class="linenos">24</span><span class="p">}</span>
</pre></div>
</div>
<p>There are 3 lines in this file needing changing. In Line 3 you need to set the <strong>appID</strong> to be equal to name of the app you created in step 3. You need to set the <strong>inputDirectory</strong> equal to the location where you placed the <strong>piMPI.c</strong> file on line 5 and finally the name of the program to compile and run <strong>programName</strong> needs to be set on line 8. Other options are set for the piMPI application such as runTime, numNodes and numCores.</p>
<p>After the file has been saved, submits it to a tapis job service by typing the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">jobs</span> <span class="n">submit</span> <span class="o">-</span><span class="n">F</span> <span class="n">cloneSubmit</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Tapis will respond with a message that hopefully says the job was submitted sucessfully and will provide a <strong>jobID</strong>. That <strong>jobID</strong> is important, as you will use it to query status of job and download job information when job finished.</p>
<p>To look up for job status, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">jobs</span> <span class="n">status</span> <span class="o">-</span><span class="n">f</span> <span class="n">json</span> <span class="mi">5</span><span class="n">ce7f59d</span><span class="o">-</span><span class="mi">0</span><span class="n">c4f</span><span class="o">-</span><span class="mi">46</span><span class="n">c1</span><span class="o">-</span><span class="mi">806</span><span class="n">a</span><span class="o">-</span><span class="mi">35965317525</span><span class="n">f</span><span class="o">-</span><span class="mi">007</span>
</pre></div>
</div>
<p>There are a number of states a job might be in, <strong>queued</strong>, <strong>running</strong>, <strong>finished</strong>, and the dreaded <strong>failed</strong>. Once a job has finished you can download the results with</p>
<p>tapis jobs  show –f json 5ce7f59d-0c4f-46c1-806a-35965317525f-007</p>
<p>This results in a long list of output. Buried in it is the <strong>archivePath</strong> section. This is where the results have been stored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-01-08T10:19:45.773Z&quot;</span><span class="p">,</span>
<span class="s2">&quot;appId&quot;</span><span class="p">:</span> <span class="s2">&quot;mpiCompileSimCenter.tg457427-0.0.1&quot;</span><span class="p">,</span>
<span class="s2">&quot;appUuid&quot;</span><span class="p">:</span> <span class="s2">&quot;7984683744829894165-242ac117-0001-005&quot;</span><span class="p">,</span>
<span class="s2">&quot;archive&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
<span class="s2">&quot;archivePath&quot;</span><span class="p">:</span> <span class="s2">&quot;tg457427/archive/jobs/job-507792d1-35b0-4dc0-abd2-421cfba7ddc3-007&quot;</span><span class="p">,</span>
<span class="s2">&quot;archiveSystem&quot;</span><span class="p">:</span> <span class="s2">&quot;designsafe.storage.default&quot;</span><span class="p">,</span>
<span class="s2">&quot;blockedCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-01-08T10:19:45.779Z&quot;</span><span class="p">,</span>
<span class="s2">&quot;ended&quot;</span><span class="p">:</span> <span class="s2">&quot;7 hours ago&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>The results folder can be viewed using the <strong>tapis files list</strong> command, i.e. for my job I would list the files in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="nb">list</span> <span class="n">agave</span><span class="p">:</span><span class="o">//</span><span class="n">designsafe</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default</span><span class="o">/</span><span class="n">tg457427</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">jobs</span><span class="o">/</span><span class="n">job</span><span class="o">-</span><span class="mi">507792</span><span class="n">d1</span><span class="o">-</span><span class="mi">35</span><span class="n">b0</span><span class="o">-</span><span class="mi">4</span><span class="n">dc0</span><span class="o">-</span><span class="n">abd2</span><span class="o">-</span><span class="mi">421</span><span class="n">cfba7ddc3</span><span class="o">-</span><span class="mi">007</span>
</pre></div>
</div>
<p>In this folder you will see a long file names ending in <strong>.out</strong>. You can download these files using the <strong>tapis files download</strong> command. The results of the file I submitted is as shown below.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>Shell debugging temporarily silenced: export LMOD_SH_DBG_ON=1 for Lmod&#39;s output
<span class="linenos"> 2</span>Shell debugging restarted
<span class="linenos"> 3</span>program file is piMPI.c
<span class="linenos"> 4</span>/scratch1/00477/tg457427/scratch1/00477/tg457427/tg457427/job-507792d1-35b0-4dc0-abd2-421cfba7ddc3-007-run-1
<span class="linenos"> 5</span>total 33
<span class="linenos"> 6</span>4 drwx------ 4 tg457427 G-80610 4096 Jan  8 04:21 .
<span class="linenos"> 7</span>4 drwx------ 3 tg457427 G-80610 4096 Jan  8 04:19 ..
<span class="linenos"> 8</span>4 -rw------- 1 tg457427 G-80610  345 Jan  8 04:19 .agave.archive
<span class="linenos"> 9</span>4 -rw------- 1 tg457427 G-80610   28 Jan  8 04:19 .agave.log
<span class="linenos">10</span>4 drwx------ 2 tg457427 G-80610 4096 Jan  8 04:19 demo2
<span class="linenos">11</span>1 -rw------- 1 tg457427 G-80610  653 Jan  8 04:22 run-1-507792d1-35b0-4dc0-abd2-421cfba7ddc3-007.err
<span class="linenos">12</span>1 -rw------- 1 tg457427 G-80610  239 Jan  8 04:22 run-1-507792d1-35b0-4dc0-abd2-421cfba7ddc3-007.out
<span class="linenos">13</span>4 -rwx------ 1 tg457427 G-80610 2132 Jan  8 04:19 run-1.ipcexe
<span class="linenos">14</span>4 drwx------ 3 tg457427 G-80610 4096 Jan  8 04:19 test
<span class="linenos">15</span>4 -rw------- 1 tg457427 G-80610  401 Jan  8 04:19 wrapper.sh
<span class="linenos">16</span>currentDIR
<span class="linenos">17</span>/scratch1/00477/tg457427/scratch1/00477/tg457427/tg457427/job-507792d1-35b0-4dc0-abd2-421cfba7ddc3-007-run-1/demo2
<span class="linenos">18</span>directory listing
<span class="linenos">19</span>total 12
<span class="linenos">20</span>4 drwx------ 2 tg457427 G-80610 4096 Jan  8 04:19 .
<span class="linenos">21</span>4 drwx------ 4 tg457427 G-80610 4096 Jan  8 04:21 ..
<span class="linenos">22</span>4 -rw------- 1 tg457427 G-80610 1286 Jan  8 04:19 piMPI.c
<span class="linenos">23</span>TACC:  Starting up job 2332652 
<span class="linenos">24</span>TACC:  Starting parallel tasks... 
<span class="linenos">25</span>PI =       3.14159265, duration: 0.080000 s
<span class="linenos">26</span>TACC:  Shutdown complete. Exiting. 
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>A demonstration is contained at end of the Video</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/HDo5QzwOjTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p></div>
</div>
<div class="section" id="step-5-allowing-others-to-use-your-app">
<h2>Step 5: Allowing Others to Use your App<a class="headerlink" href="#step-5-allowing-others-to-use-your-app" title="Permalink to this headline">¶</a></h2>
<p>Sharing of resources is something built into <strong>Tapis</strong>, which  allows researchers to share resoures (execution sytems, files, and apps). Check out the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">files</span> <span class="n">pems</span> <span class="n">drop</span>
<span class="n">tapis</span> <span class="n">files</span> <span class="n">pems</span> <span class="n">grant</span>
<span class="n">tapis</span> <span class="n">files</span> <span class="n">pems</span> <span class="nb">list</span>
<span class="n">tapis</span> <span class="n">files</span> <span class="n">pems</span> <span class="n">revoke</span>
<span class="n">tapis</span> <span class="n">files</span> <span class="n">pems</span> <span class="n">show</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">roles</span> <span class="n">drop</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">roles</span> <span class="n">grant</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">roles</span> <span class="nb">list</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">roles</span> <span class="n">revoke</span>
<span class="n">tapis</span> <span class="n">systems</span> <span class="n">roles</span> <span class="n">show</span>
<span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="n">grant</span>
<span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="nb">list</span>
<span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="n">revoke</span>
<span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="n">show</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are other tapis options that will allow you to <strong>publish</strong> and <strong>unpblish</strong> your resources, but these are not available to you to use.</p>
</div>
<p>For this exercise you need to select a partner, each of you need to swap usernames. You are then going to allow your partner to use your app and then you are going to run your job with their app.</p>
<p>For this purpose, first look at your existing permissions issue using the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="n">show</span> <span class="n">mpiCompileRunYOUR_NAME</span><span class="o">-</span><span class="mf">0.0.1</span>
</pre></div>
</div>
<p>To add someone to your app who can execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tapis</span> <span class="n">apps</span> <span class="n">pems</span> <span class="n">show</span> <span class="n">mpiCompileRunYOUR_NAME</span><span class="o">-</span><span class="mf">0.0.1</span>
</pre></div>
</div>
<p>You should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+------+-------+---------+</span>
<span class="o">|</span> <span class="n">username</span> <span class="o">|</span> <span class="n">read</span> <span class="o">|</span> <span class="n">write</span> <span class="o">|</span> <span class="n">execute</span> <span class="o">|</span>
<span class="o">+----------+------+-------+---------+</span>
<span class="o">|</span> <span class="n">tg457427</span> <span class="o">|</span> <span class="kc">True</span> <span class="o">|</span> <span class="kc">True</span>  <span class="o">|</span> <span class="kc">True</span>    <span class="o">|</span>
<span class="o">+----------+------+-------+---------+</span>
</pre></div>
</div>
<p>Now, to allow the user fmk to execute your app, you would issue the command shown below. Change <strong>fmk</strong> to your partners name and issue the following:</p>
<blockquote>
<div><p>tapis apps pems grant mpiCompileRunYOUR_NAME-0.0.1 fmk EXECUTE</p>
</div></blockquote>
<p>Now you should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-------+-------+---------+</span>
<span class="o">|</span> <span class="n">username</span> <span class="o">|</span> <span class="n">read</span>  <span class="o">|</span> <span class="n">write</span> <span class="o">|</span> <span class="n">execute</span> <span class="o">|</span>
<span class="o">+----------+-------+-------+---------+</span>
<span class="o">|</span> <span class="n">tg457427</span> <span class="o">|</span> <span class="kc">True</span>  <span class="o">|</span> <span class="kc">True</span>  <span class="o">|</span> <span class="kc">True</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">fmk</span>      <span class="o">|</span> <span class="kc">False</span> <span class="o">|</span> <span class="kc">False</span> <span class="o">|</span> <span class="kc">True</span>    <span class="o">|</span>
<span class="o">+----------+-------+-------+---------+</span>
</pre></div>
</div>
<p>Now see if you can figure out how to do the following:</p>
<ol class="arabic simple">
<li><p>Find your partners application using tapis apps search</p></li>
<li><p>Edit your job script to point to your partners app.</p></li>
<li><p>Launch the job using your partners application.</p></li>
<li><p>Check your program still works!</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="git.html" class="btn btn-neutral float-right" title="Git" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="assignment_C4.html" class="btn btn-neutral float-left" title="C: Assignments Day 4" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2022, Peter Mackenzie-Helnwein, Frank McKenna.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>